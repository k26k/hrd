<!DOCTYPE html>
<html 	xmlns:th="http://www.thymeleaf.org"
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
		layout:decorate="~{layouts/layoutSmall}">
	<meta charset="UTF-8">

	<th:block layout:fragment="meta">
		<meta id="csrf_header" th:content="${_csrf.headerName}"/>
		<meta id="csrf_parameter" th:content="${_csrf.parameterName}"/>
		<meta id="csrf_token" th:content="${_csrf.token}"/>
	</th:block>
	<th:block layout:fragment="headTitle">구매 목록</th:block>
	
	<th:block layout:fragment="script">
		<script th:inline="javascript">
			/*<![CDATA[*/
			
			function ajaxSaveItem(){
				let fmData = new FormData($("#itemForm")[0]);
				
				/* let title = $("#title");
				let titleV = title.val();
				let content = $("#content");
				let contentV = content.val();
				
				if(titleV===""){
					alert("제목을 입력해 주세요.");
					title.focus();
					return;
				}
				if(contentV===""){
					alert("내용을 입력해 주세요.");
					content.focus();
					return;
				} */
				let csrfH = csrf_header.content;
				let csrfP = csrf_parameter.content;
				let csrfT = csrf_token.content;
				console.log("csrfH : "+csrfH);
				console.log("csrfP : "+csrfP);
				console.log("csrfT : "+csrfT);
				console.log("fmdata : ", fmData);
				
				$.ajax({
					type:"post",
					enctype:"multipart/form-data",
				    url:$("#itemForm").attr("action"),
				    dataType:"json",
				    processData:false,
				    contentType:false,
				    cache:false,
					data: fmData,        
			        timeout: 600000, 
					beforeSend : function(xhr)
		            {   
						/*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
						xhr.setRequestHeader(csrfH, csrfT);
		            },
					success:function(data){
						console.log(data);
						if(data.result){
							alert(data.message);
							location.href=data.redirectLink;
						}else{
							alert(data.message);
						}
					},
					error:function(error){
						alert("다시 시도해 주세요.");
						console.error(error);
						console.error(error.responseText);
					}
				});
				return false;
				colsole.log("false");
			};
			
			/* function changeAction(){
				$("#itemForm").attr("action", $(submit).attr("formaction"));
			}
			
			$(function(){
				console.log($(":file"))
				$(":file").each(function(obj){
					obj.change(console.log(obj));
					console.log(obj);
				})
			}); */
				
			/*]]>*/
		</script>
	</th:block>
	
	<th:block layout:fragment="mainTitle">
		<h2>구매 목록</h2>
	</th:block>
	
	<th:block layout:fragment="content">
		<!-- <div th:object="${itemSearchDto}">
			<form role="search" th:action="@{/item/list/}" method="get">
				<div class="row">
					<div class="d-flex">
						<select th:field="*{searchBy}" class="form-select w-auto m-1" name="searchBy">
							<option value="itemName">제목</option>
							<option value="price">가격</option>
							<option value="itemDetail">상세설명</option>
							<option value="createdBy">상품 등록자</option>
						</select>
						<input th:field="*{searchQuery}" class="form-control m-1" type="search" placeholder="Search" aria-label="Search" name="searchQuery">
						<button class="btn btn-outline-success m-1" type="submit">Search</button>
					</div>
				</div>
			</form>
		</div> -->
		<!-- <hr> -->
		<div class="row px-2">
			<th:block th:each="order : ${orderPage}">
				<div class="px-1 py-2">
					<div class="card">
						<div class="text-start px-2 py-1">
							<span th:text="${order.orderId}"></span>번 주문
						</div>
						<hr class="my-1">
						<div th:each="orderItem : ${order.orderItemList} " class="text-center px-2 py-1">
							<div>
								<span th:text="${orderItem.id}"></span>번 상품, 상품명: <span th:text="${orderItem.name}"></span>
							</div>
							<div>
								<span th:text="${orderItem.price}"></span>원 <span th:text="${orderItem.count}"></span>개 주문 총 <span th:text="${orderItem.totalPrice}"></span>원
							</div>
						</div>
						<hr class="my-1">
						<div class="text-end px-2 py-1">
							총 주문 금액: <span th:text="${order.totalPrice}"></span>원
						</div>
						<hr class="my-1">
						<div class="text-end px-2 py-1">
							<a th:href="'/order/cancle/'+${order.orderId}" class="btn btn-warning" >취소</a>
						</div>
					</div>
				</div>
			</th:block>
		</div>
		<hr>
		<!-- <div>
			<nav th:with="pageNow=${itemPage.number}+1, start=1, end= ${itemPage.totalPages} >= 1 ? ${itemPage.totalPages} : 1 " class="w-auto row justify-content-center m-0">
				<ul class="nav row w-auto m-0">
					<li class="w-auto nav-item p-0">
						<a th:if="${start} >= ${pageNow}" class=" btn btn-outline-secondary disabled m-1">&lt;&lt;</a>
						<a th:unless="${start} eq ${pageNow}" th:href="'/item/list/' + ${start}" class="btn btn-outline-secondary m-1">&lt;&lt;</a>
					</li>
					<li th:each="page : ${#numbers.sequence(start, end)}" class="w-auto nav-item p-0">
						<a th:if="${page} eq ${pageNow}" th:text="${page}" class="btn btn-outline-secondary disabled m-1"></a>
						<a th:unless="${page} eq ${pageNow}" th:href="'/item/list/' + ${page}" th:text="${page}" class="btn btn-outline-secondary m-1"></a>
					</li>
					<li class="w-auto nav-item p-0">
						<a th:if="${end} <= ${pageNow}" class="btn btn-outline-secondary disabled m-1">&gt;&gt;</a>
						<a th:unless="${end} <= ${pageNow}" th:href="'/item/list/' + ${end}" class="btn btn-outline-secondary m-1">&gt;&gt;</a>
					</li>
				</ul>
			</nav>
		</div> -->
	</th:block>

</html>